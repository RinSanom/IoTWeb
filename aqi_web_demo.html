<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AQI Monitor - Air Quality Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        color: #333;
      }

      .header h1 {
        font-size: 3em;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .current-aqi {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .aqi-value {
        font-size: 4em;
        font-weight: bold;
        margin: 20px 0;
      }

      .aqi-category {
        font-size: 1.5em;
        padding: 10px 20px;
        border-radius: 25px;
        color: white;
        display: inline-block;
        margin: 10px 0;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .card h3 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.3em;
      }

      .parameter {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }

      .parameter:last-child {
        border-bottom: none;
      }

      .forecast-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        margin: 10px 0;
        background: #f8f9fa;
        border-radius: 10px;
      }

      .forecast-aqi {
        font-weight: bold;
        padding: 5px 15px;
        border-radius: 15px;
        color: white;
      }

      .health-advice {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
      }

      .loading {
        text-align: center;
        padding: 50px;
        color: #666;
      }

      .error {
        background: #ffebee;
        border-left: 4px solid #f44336;
        padding: 20px;
        border-radius: 10px;
        color: #c62828;
      }

      .refresh-btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1em;
        margin: 20px auto;
        display: block;
        transition: transform 0.2s;
      }

      .refresh-btn:hover {
        transform: scale(1.05);
      }

      .timestamp {
        text-align: center;
        color: #666;
        font-size: 0.9em;
        margin-top: 20px;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2em;
        }
        .aqi-value {
          font-size: 3em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üåç AQI Monitor</h1>
        <p>Real-time Air Quality Index Predictions</p>
        <p>üìç Cambodia (Phnom Penh area)</p>
      </div>

      <div id="loading" class="loading">
        <h3>üîÑ Loading AQI data...</h3>
      </div>

      <div id="error" class="error" style="display: none">
        <h3>‚ùå Error loading data</h3>
        <p id="error-message"></p>
      </div>

      <div id="dashboard" style="display: none">
        <!-- Current AQI Display -->
        <div class="current-aqi">
          <h2>Current Air Quality</h2>
          <div id="current-aqi-value" class="aqi-value">--</div>
          <div id="current-aqi-category" class="aqi-category">Loading...</div>
          <div id="current-timestamp" class="timestamp"></div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
          <!-- Current Parameters -->
          <div class="card">
            <h3>üìä Current Parameters</h3>
            <div id="current-parameters">
              <div class="parameter">
                <span>PM1:</span>
                <span id="param-pm1">-- ¬µg/m¬≥</span>
              </div>
              <div class="parameter">
                <span>PM2.5:</span>
                <span id="param-pm25">-- ¬µg/m¬≥</span>
              </div>
              <div class="parameter">
                <span>Temperature:</span>
                <span id="param-temp">-- ¬∞C</span>
              </div>
              <div class="parameter">
                <span>Humidity:</span>
                <span id="param-humidity">-- %</span>
              </div>
            </div>
          </div>

          <!-- 24-Hour Forecast -->
          <div class="card">
            <h3>‚è∞ Next 12 Hours</h3>
            <div id="hourly-forecast">Loading hourly forecast...</div>
          </div>

          <!-- 7-Day Forecast -->
          <div class="card">
            <h3>üìÖ 7-Day Forecast</h3>
            <div id="daily-forecast">Loading daily forecast...</div>
          </div>
        </div>

        <!-- Health Advice -->
        <div id="health-advice" class="health-advice">
          <h3>üí° Health Advice</h3>
          <p id="advice-text">Loading health advice...</p>
        </div>

        <button class="refresh-btn" onclick="loadData()">
          üîÑ Refresh Data
        </button>
        <div class="timestamp">
          Last updated: <span id="last-updated">--</span>
        </div>
      </div>
    </div>

    <script>
      // AQI color mapping
      const aqiColors = {
        Good: "#00E400",
        Moderate: "#FFFF00",
        "Unhealthy for Sensitive Groups": "#FF7E00",
        Unhealthy: "#FF0000",
        "Very Unhealthy": "#8F3F97",
        Hazardous: "#7E0023",
      };

      // Health advice mapping
      const healthAdvice = {
        Good: "Air quality is good. Ideal conditions for outdoor activities.",
        Moderate:
          "Air quality is moderate. Sensitive individuals should consider reducing prolonged outdoor activities.",
        "Unhealthy for Sensitive Groups":
          "Unhealthy for sensitive groups. People with respiratory conditions should limit outdoor activities.",
        Unhealthy:
          "Unhealthy air quality. Everyone should reduce outdoor activities.",
        "Very Unhealthy":
          "Very unhealthy air quality. Avoid outdoor activities.",
        Hazardous:
          "Hazardous air quality. Stay indoors and avoid all outdoor activities.",
      };

      async function loadData() {
        try {
          document.getElementById("loading").style.display = "block";
          document.getElementById("dashboard").style.display = "none";
          document.getElementById("error").style.display = "none";

          // Try to load from static JSON first, then fallback to API
          let data;
          try {
            const response = await fetch("aqi_web_data.json");
            if (response.ok) {
              data = await response.json();
            } else {
              throw new Error("Static file not found");
            }
          } catch (e) {
            // Fallback to API or generate sample data
            data = generateSampleData();
          }

          displayData(data);
        } catch (error) {
          console.error("Error loading data:", error);
          showError(error.message);
        }
      }

      function generateSampleData() {
        // Generate sample data for demonstration
        const now = new Date();
        const hourlyData = [];
        const dailyData = [];

        // Generate hourly data for next 12 hours
        for (let i = 0; i < 12; i++) {
          const time = new Date(now.getTime() + i * 60 * 60 * 1000);
          const baseAqi = 35 + Math.random() * 30;
          hourlyData.push({
            datetime: time.toISOString(),
            predicted_aqi: Math.round(baseAqi),
            category: baseAqi <= 50 ? "Good" : "Moderate",
            parameters: {
              pm1: Math.round((8 + Math.random() * 12) * 100) / 100,
              pm25: Math.round((15 + Math.random() * 20) * 100) / 100,
              temperature: Math.round((25 + Math.random() * 8) * 10) / 10,
              humidity: Math.round((55 + Math.random() * 20) * 10) / 10,
            },
          });
        }

        // Generate daily data for next 7 days
        for (let i = 0; i < 7; i++) {
          const date = new Date(now.getTime() + i * 24 * 60 * 60 * 1000);
          const baseAqi = 30 + Math.random() * 40;
          dailyData.push({
            datetime: date.toISOString(),
            predicted_aqi: Math.round(baseAqi),
            category: baseAqi <= 50 ? "Good" : "Moderate",
            parameters: {
              pm1: Math.round((6 + Math.random() * 15) * 100) / 100,
              pm25: Math.round((12 + Math.random() * 25) * 100) / 100,
              temperature: Math.round((24 + Math.random() * 10) * 10) / 10,
              humidity: Math.round((50 + Math.random() * 30) * 10) / 10,
            },
          });
        }

        return {
          metadata: {
            generated_at: now.toISOString(),
            model_accuracy: "99.95%",
          },
          current: {
            aqi: hourlyData[0].predicted_aqi,
            category: hourlyData[0].category,
            timestamp: now.toISOString(),
          },
          forecasts: {
            hourly_24h: hourlyData,
            daily_7d: dailyData,
          },
        };
      }

      function displayData(data) {
        // Display current AQI
        const currentAqi = data.current
          ? data.current.aqi
          : data.forecasts.hourly_24h[0].predicted_aqi;
        const currentCategory = data.current
          ? data.current.category
          : data.forecasts.hourly_24h[0].category;

        document.getElementById("current-aqi-value").textContent =
          Math.round(currentAqi);

        const categoryElement = document.getElementById("current-aqi-category");
        categoryElement.textContent = currentCategory;
        categoryElement.style.backgroundColor = aqiColors[currentCategory];

        // Display current parameters
        const currentParams = data.forecasts.hourly_24h[0].parameters;
        document.getElementById(
          "param-pm1"
        ).textContent = `${currentParams.pm1} ¬µg/m¬≥`;
        document.getElementById(
          "param-pm25"
        ).textContent = `${currentParams.pm25} ¬µg/m¬≥`;
        document.getElementById(
          "param-temp"
        ).textContent = `${currentParams.temperature}¬∞C`;
        document.getElementById(
          "param-humidity"
        ).textContent = `${currentParams.humidity}%`;

        // Display hourly forecast
        const hourlyContainer = document.getElementById("hourly-forecast");
        hourlyContainer.innerHTML = "";
        data.forecasts.hourly_24h.slice(1, 7).forEach((item) => {
          const time = new Date(item.datetime);
          const forecastItem = document.createElement("div");
          forecastItem.className = "forecast-item";
          forecastItem.innerHTML = `
                    <span>${time.toLocaleTimeString([], {
                      hour: "2-digit",
                      minute: "2-digit",
                    })}</span>
                    <span class="forecast-aqi" style="background-color: ${
                      aqiColors[item.category]
                    }">${Math.round(item.predicted_aqi)}</span>
                `;
          hourlyContainer.appendChild(forecastItem);
        });

        // Display daily forecast
        const dailyContainer = document.getElementById("daily-forecast");
        dailyContainer.innerHTML = "";
        data.forecasts.daily_7d.forEach((item) => {
          const date = new Date(item.datetime);
          const forecastItem = document.createElement("div");
          forecastItem.className = "forecast-item";
          forecastItem.innerHTML = `
                    <span>${date.toLocaleDateString([], {
                      weekday: "short",
                      month: "short",
                      day: "numeric",
                    })}</span>
                    <span class="forecast-aqi" style="background-color: ${
                      aqiColors[item.category]
                    }">${Math.round(item.predicted_aqi)}</span>
                `;
          dailyContainer.appendChild(forecastItem);
        });

        // Display health advice
        document.getElementById("advice-text").textContent =
          healthAdvice[currentCategory];

        // Update timestamps
        const generatedTime = new Date(data.metadata.generated_at);
        document.getElementById(
          "current-timestamp"
        ).textContent = `As of ${generatedTime.toLocaleString()}`;
        document.getElementById("last-updated").textContent =
          generatedTime.toLocaleString();

        // Show dashboard
        document.getElementById("loading").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
      }

      function showError(message) {
        document.getElementById("loading").style.display = "none";
        document.getElementById("error").style.display = "block";
        document.getElementById("error-message").textContent = message;
      }

      // Load data when page loads
      window.addEventListener("load", loadData);

      // Auto-refresh every 10 minutes
      setInterval(loadData, 10 * 60 * 1000);
    </script>
  </body>
</html>
